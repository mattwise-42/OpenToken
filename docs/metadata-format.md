# OpenToken Metadata Format Documentation

## Overview

OpenToken generates metadata files alongside the output files to provide information about the processed data. These metadata files contain statistical information about the processed records like the invalid attributes, number of records processed, blank tokens generated by rule, system/runtime information, and secure hashes of the secrets used during token generation.

## Metadata Format

The metadata is stored in JSON format with the extension `.metadata.json` and contains key-value pairs representing various aspects of the processing.

## Metadata Fields

| Field                            | Description                                                                                     |
| -------------------------------- | ----------------------------------------------------------------------------------------------- |
| `JavaVersion` / `PythonVersion`  | The version of Java or Python used to run the processing (field name depends on platform)      |
| `OpenTokenVersion`               | The version of the OpenToken library                                                            |
| `Platform`                       | The platform/environment used for processing (e.g., "Java" or "Python")                         |
| `TotalRows`                      | The total number of records processed                                                           |
| `TotalRowsWithInvalidAttributes` | The number of records that contained one or more invalid attributes                             |
| `InvalidAttributesByType`        | A breakdown of invalid attributes by type, showing the count for each attribute type            |
| `BlankTokensByRule`              | A breakdown of blank tokens generated by rule/token identifier, showing the count for each rule |
| `HashingSecretHash`              | SHA-256 hash of the hashing secret used for HMAC-SHA256 (hex-encoded)                           |
| `EncryptionSecretHash`           | SHA-256 hash of the encryption key used for AES-256 encryption (hex-encoded)                    |

## Security Considerations

The metadata file contains SHA-256 hashes of the secrets used during token generation. These hashes allow verification that the correct secrets were used without exposing the actual secret values. The hashes are calculated using:

```text
SHA-256(secret_value) -> hex-encoded string
```

## Hash Calculator Tool

A Python tool is provided to independently calculate the same SHA-256 hashes used in the metadata file. This tool can be used to verify that the correct secrets were used or to calculate hashes for comparison purposes.

The tool is located at `tools/hash_calculator.py` and can be used as follows:

```bash
# Calculate hash for a hashing secret
python tools/hash_calculator.py --hashing-secret "your-hashing-secret"

# Calculate hash for an encryption key
python tools/hash_calculator.py --encryption-key "your-encryption-key"

# Calculate both hashes
python tools/hash_calculator.py --hashing-secret "your-hashing-secret" --encryption-key "your-encryption-key"
```

The tool outputs the calculated hashes in the same format as stored in the metadata file, making it easy to verify that the correct secrets were used during token generation.

## Example

```json
{
  "Platform": "Java",
  "JavaVersion": "11.0.27",
  "OpenTokenVersion": "1.7.0",
  "TotalRows": "101",
  "TotalRowsWithInvalidAttributes": "9",
  "InvalidAttributesByType": {
    "SocialSecurityNumber": 2,
    "FirstName": 1,
    "PostalCode": 1,
    "LastName": 2,
    "BirthDate": 3
  },
  "BlankTokensByRule": {
    "T1": 5,
    "T2": 12,
    "T3": 3,
    "T4": 8,
    "T5": 7
  },
  "HashingSecretHash": "e0b4e60b6a9f7ea3b13c0d6a6e1b8c5d4e3f2a9b8c7d6e5f4a3b2c1d0e9f8a7b6c5d4e3f2a1b0c9d8e7f6a5b4c3d2e1f0",
  "EncryptionSecretHash": "a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8"
}
```
